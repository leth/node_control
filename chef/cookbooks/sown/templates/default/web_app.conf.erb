<VirtualHost *:80>
  DocumentRoot <%= @params[:docroot] %>
  ServerAdmin support@sown.org.uk
  RewriteEngine On
  
  <Directory <%= @params[:docroot] %>>
    Options Indexes FollowSymLinks MultiViews
    AllowOverride All
    Order allow,deny
    allow from all
  </Directory>
  
  <Directory />
    Options FollowSymLinks
    AllowOverride None
  </Directory>

  <Location /server-status>
    SetHandler server-status

    Order Deny,Allow
    Deny from all
    Allow from 127.0.0.1
  </Location>

  LogLevel info
  ErrorLog <%= node[:apache][:log_dir] %>/<%= @params[:name] %>-error.log
  CustomLog <%= node[:apache][:log_dir] %>/<%= @params[:name] %>-access.log combined

  RewriteEngine On
  RewriteLog <%= node[:apache][:log_dir] %>/<%= @application_name %>-rewrite.log
  RewriteLogLevel 0

  RewriteCond %{DOCUMENT_ROOT}/system/maintenance.html -f
  RewriteCond %{SCRIPT_FILENAME} !maintenance.html
  RewriteRule ^.*$ /system/maintenance.html [L]
</VirtualHost>

# <VirtualHost *:443>
#   DocumentRoot <%= @params[:docroot] %>
#   ServerAdmin support@sown.org.uk
#   RewriteEngine On
  
#   SSLEngine on

#   # StdEnvVars is required to pass SSL values on to php
#   # ExportCertData is required to give php the _whole_ certificate
#   SSLOptions +StrictRequire +StdEnvVars +ExportCertData

#   <Directory />
#     SSLRequireSSL
#   </Directory>

#   <Location /package/config/backfire>
#     SSLCACertificatePath /etc/apache2/ssl/
#     SSLVerifyClient require
#   </Location>

#   SSLProtocol -all +TLSv1 +SSLv3
#   SSLCipherSuite HIGH:MEDIUM:!aNULL:+SHA1:+MD5:+HIGH:+MEDIUM

#   SSLCertificateFile /etc/apache2/ssl/server.crt
#   SSLCertificateKeyFile /etc/apache2/ssl/server.key

#   SSLProxyEngine off

#   <IfModule mime.c>
#       AddType application/x-x509-ca-cert      .crt
#       AddType application/x-pkcs7-crl         .crl
#   </IfModule>

#   <Directory <%= @params[:docroot] %>>
#     Options Indexes FollowSymLinks MultiViews
#     AllowOverride All
#     Order allow,deny
#     allow from all
#   </Directory>
  
#   <Directory />
#     Options FollowSymLinks
#     AllowOverride None
#   </Directory>

#   <Location /server-status>
#     SetHandler server-status

#     Order Deny,Allow
#     Deny from all
#     Allow from 127.0.0.1
#   </Location>

#   LogLevel info
#   ErrorLog <%= node[:apache][:log_dir] %>/<%= @params[:name] %>-error.log
#   CustomLog <%= node[:apache][:log_dir] %>/<%= @params[:name] %>-access.log combined

#   RewriteEngine On
#   RewriteLog <%= node[:apache][:log_dir] %>/<%= @application_name %>-rewrite.log
#   RewriteLogLevel 0

#   # Canonical host, <%= @params[:server_name] %>
#   RewriteCond %{HTTP_HOST}   !^<%= @params[:server_name] %> [NC]
#   RewriteCond %{HTTP_HOST}   !^$
#   RewriteRule ^/(.*)$        http://<%= @params[:server_name] %>/$1 [L,R=301]

#   RewriteCond %{DOCUMENT_ROOT}/system/maintenance.html -f
#   RewriteCond %{SCRIPT_FILENAME} !maintenance.html
#   RewriteRule ^.*$ /system/maintenance.html [L]
# </VirtualHost>
